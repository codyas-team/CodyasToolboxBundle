const App={initComponents:function(e){e=e||$("body"),App.initDatepicker(e),App.initDateTimePicker(e),App.initDropdown(e),App.initTooltips(e)},initDatepicker:function(e){e=e||$("body");let t=this;e.find(".widget-datepicker").each(function(e){let a=$(this).data("dpDefines"),o=$(this).data("dpDefined"),n=$(this).data("dpFormat");if(n=n||"M/d/Y",void 0!==a&&$(this).on("change",function(){$(`#${a}`).val("").trigger("change"),document.querySelector(`#${a}`)._flatpickr.set("minDate",t.getStartDateForDefiner($(this)))}),$(this).hasClass("future-disabled"))$(this).flatpickr({dateFormat:n,maxDate:new Date});else{let e=void 0!==o?t.getStartDateForDefiner($("#"+o)):null;$(this).flatpickr({dateFormat:n,minDate:e?new Date(e):null})}})},initDateTimePicker:function(e){let t=this;(e=e||$("body")).find(".widget-datetimepicker").each(function(e){let a=$(this).data("dp-defines"),o=$(this).data("dp-defined");void 0!==a&&$(this).on("change",function(){let e=$("#"+a);e.val("").trigger("change"),e.datetimepicker("setStartDate",t.getStartDateTimeForDefiner($(this)))});let n,i=null;if($(this).hasClass("future-disabled"))i=new Date;else if($(this).hasClass("past-disabled"))n=new Date;else{let e=$("#"+o);n=void 0!==o?t.getStartDateTimeForDefiner(e):null}$(this).datetimepicker({format:"M/dd/yyyy hh:ii",endDate:i,startDate:n})})},getStartDateForDefiner:function(e){let t=e.data("dpMomentFormat");t=t||"MMM/DD/YYYY";let a=moment(e.val(),t);return a.add("1","days"),a.format(t)},getStartDateTimeForDefiner:function(e){let t=e.data("dpMomentFormat");t=t||"MMM/DD/YYYY hh:ii";let a=moment(e.val(),t);return a.add("1","hours"),a.format(t)},initDropdown:function(e){(e=e||$("body")).find(".form-select").each(function(t){$(this).select2({width:"100%",clear:!0,placeholder:$(this).attr("placeholder"),disabled:"readonly"===$(this).attr("readonly"),parent:e})})},initTooltips:function(e){e=e||$("body")},appendForm:function(e,t,a,o){let n=(o=o||$(e.attr("data-list"))).data("widget-counter")|o.children().length,i=o.attr("data-widget-tags");a=a||"__name__",n||(n=o.children().length);let r=e.data("prototype"),l=new RegExp(a,"g");r=r.replace(l,n),i=i.replace(l,n),n++,o.data("widget-counter",n);let d=$(i).html(r),s="odd";n%2==0&&(s="even"),d.addClass(s).addClass("d-none"),"insert-before"===e.data("policy")?e.parents("li").before(d):(d.appendTo(o),d.removeClass("d-none")),t($(d))},initValidation:function(e,t,a,o){e.validate({ignore:":not(:visible),:disabled",errorElement:"span",errorPlacement:function(e,t){e.addClass("mt-2 mb-2 text-danger validation-error"),"checkbox"===t.prop("type")?e.insertAfter(t.parents(".checkbox")):"radio"===t.prop("type")?e.insertAfter(t.parents(".icheck")):t.is("select")&&(t.hasClass("select2")||t.hasClass("select2-ph"))?e.insertAfter(t.siblings(".select2")):t.is("textarea")&&t.hasClass("lc-ckeditor")?e.insertAfter(t.siblings(".ck-editor")):t.is("input")&&t.parents(".input-group").length>0?e.insertAfter(t.parents(".input-group")):e.insertAfter(t)},highlight:function(e,t,a){$(e).addClass("is-invalid").removeClass("is-valid")},unhighlight:function(e,t,a){$(e).addClass("is-valid").removeClass("is-invalid")},submitHandler:function(e){return t?t(e):($.LoadingOverlay("show"),$.ajax({url:$(e).prop("action"),method:"post",data:$(e).serialize(),success:function(e){a(e)},error:function(e){o(e)},complete:function(){$.LoadingOverlay("hide")}})),!1}})}};function CrudManager(e,t){this.$scope=e,!0===e.data("crudDecoupled")?(this.$formModal=$(e.data("crudRefFormModal")),this.$filterDrawer=$(e.data("crudRefFilterFormDrawer")),this.$newRecordBtn=$(e.data("crudRefNewRecordBtn")),this.$simpleFilter=$(e.data("crudRefSimpleFilterControl"))):(this.$formModal=e.find(".modal-form"),this.$filterDrawer=e.find(".modal-filter"),this.$newRecordBtn=e.find(".btn-new-record"),this.$simpleFilter=e.find(".simple-filter")),this.$formFilter=this.$filterDrawer.find("form"),this.$btnSaveModal=this.$formModal.find(".btn-save"),this.$btnNextModal=this.$formModal.find(".btn-next"),this.$table=e.find(".crud-table"),this.$formatExport=e.find(".format-export"),void 0!==t&&t.isChained&&(this.isChained=!0)}CrudManager.prototype={$scope:null,$newRecordBtn:null,$formModal:null,$filterDrawer:null,$formFilter:null,$btnOpenFilter:null,$simpleFilter:null,$btnSaveModal:null,$btnNextModal:null,$table:null,$formatExport:null,appendBtn:".crud-append-btn",relativeAppendBtn:".crud-relative-append-btn",collectionRemoveBtn:".collection-remove-item",collectionItem:".collection-item",dt:void 0,chainedManager:void 0,isChained:!1,constructor:CrudManager,init:function(){return this.initListeners(),this.initDataTable(),this},loadFormModal:function(e){let t=this;t.toggleBodyBlock(),$(".modal-body",t.$formModal).load(e,function(e,a){t.toggleBodyBlock(),"success"===a?(App.initComponents(t.$formModal.find(".modal-body")),t.$formModal.trigger("api_form_modal_loaded"),t.$formModal.modal("show")):Swal.fire({text:"Something went wrong while loading the form, please try again later.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok",customClass:{confirmButton:"btn btn-primary"}})})},loadModal:function(e,t){let a=this;a.toggleBodyBlock(),$(".modal-body",e).load(t,function(t){a.toggleBodyBlock(),App.initComponents(e.find(".modal-body")),e.trigger("api_form_modal_loaded"),e.modal("show")})},initListeners:function(){let e=this;e.$newRecordBtn.click(function(){e.loadFormModal($(this).data("load-url"))}),e.$formatExport.click(function(t){t.preventDefault();let a=e.$formFilter.serialize(),o=e.dt.page.info().start,n=e.dt.page.info().length,i=$(this).attr("href")+"?"+a+"&start="+o+"&length="+n;window.open(i)}),e.$simpleFilter.on("keypress",function(t){if(13===t.which){t.preventDefault();let a=$(this).data("binds");$(a,e.$formFilter).val($(this).val()),e.dt.ajax.reload(),KTDrawer.getInstance(e.$filterDrawer[0]).hide()}}),e.$formFilter.delegate("input","keypress",function(t){if(13===t.which){t.preventDefault(),e.dt.ajax.reload(),KTDrawer.getInstance(e.$filterDrawer[0]).hide()}}),e.$table.delegate(".view-record-btn","click",function(t){e.loadModal(e.$detailsModal,$(this).data("load-url")),t.preventDefault(),t.stopPropagation()}),e.$table.delegate(".edit-record-btn","click",function(t){e.loadFormModal($(this).data("load-url")),t.preventDefault(),t.stopPropagation()}),e.$table.delegate(".remove-record-btn","click",function(t){e.removeRecord($(this)),t.preventDefault(),t.stopPropagation()}),e.$formModal.on("api_form_modal_loaded",function(t){e.$formModal.find("form").validate({ignore:":not(:visible),:disabled",errorElement:"span",errorPlacement:function(e,t){e.addClass("mt-2 mb-2 text-danger validation-error"),"checkbox"===t.prop("type")?e.insertAfter(t.parent("label")):"radio"===t.prop("type")?e.insertAfter(t.parents(".icheck")):t.is("select")&&(t.hasClass("select2")||t.hasClass("select2-ph"))?e.insertAfter(t.siblings(".select2")):t.is("textarea")&&t.hasClass("lc-ckeditor")?e.insertAfter(t.siblings(".ck-editor")):t.is("input")&&t.parents(".input-group").length>0?e.insertAfter(t.parents(".input-group")):e.insertAfter(t)},highlight:function(e,t,a){$(e).addClass("is-invalid").removeClass("is-valid")},unhighlight:function(e,t,a){$(e).addClass("is-valid").removeClass("is-invalid")},submitHandler:function(t){return e.toggleBodyBlock(),$.ajax({url:$(t).prop("action"),method:"post",data:$(t).serialize(),success:function(a){e.dt.ajax.reload(),e.$formModal.modal("hide"),toastr.success("The record has been processed."),$("body").trigger("crud_form_processed",[$(t).prop("name")])},error:function(t){$(".modal-body",e.$formModal).html(t.responseText),App.initComponents(e.$formModal.find(".modal-body")),e.$formModal.trigger("api_form_modal_loaded")},complete:function(){e.toggleBodyBlock()}}),!1}}),e.$clientDataContainer=$(".new-client-container",e.$formModal)}),e.$btnSaveModal.click(function(){let t=e.$formModal.find("form");t.valid()&&t.trigger("submit")}),e.$filterDrawer.find(".btn-apply-filter").click(function(t){e.dt.ajax.reload(),KTDrawer.getInstance(e.$filterDrawer[0]).hide()}),e.$filterDrawer.find(".btn-reset-filter").click(function(t){e.$filterDrawer.find("select").each(function(e){$(this).val(null).trigger("change")})}),e.$formModal.delegate(e.appendBtn,"click",function(t){e.appendForm($(this),function(e){App.initComponents(e),e.trigger("section-appended")},$(this).data("prototypeName"))}),e.$formModal.delegate(e.relativeAppendBtn,"click",function(t){e.appendForm($(this),function(e){App.initComponents(e)},$(this).data("prototype-name"),$(this).closest(".collection-container").find(".collection-list"))}),e.$formModal.delegate(e.collectionRemoveBtn,"click",function(t){let a=$(this);Swal.fire({title:el.data("confirmation-msg-title"),text:el.data("confirmation-msg-desc"),icon:"warning",showCancelButton:!0,confirmButtonText:el.data("confirmation-msg-btn-ok"),cancelButtonText:el.data("confirmation-msg-btn-cancel")}).then(function(t){t.value&&e.removeCollectionItem(a)})})},removeCollectionItem:function(e){e.closest(this.collectionItem).addClass("d-none").remove()},removeRecord:function(e){let t=this;Swal.fire({title:e.data("confirmation-msg-title"),text:e.data("confirmation-msg-desc"),icon:"warning",showCancelButton:!0,confirmButtonText:e.data("confirmation-msg-btn-ok"),cancelButtonText:e.data("confirmation-msg-btn-cancel")}).then(function(a){a.value&&(t.toggleBodyBlock(),$.ajax({url:e.data("action-url"),method:"delete",data:{token:e.data("token")}}).done(function(e){t.dt.ajax.reload(),t.$table.trigger("record_removed",[t.dt]),toastr.success("The record has been removed.")}).fail(function(e){void 0!==e.responseJSON.msg?Swal.fire("Oops!",e.responseJSON.msg,"error"):Swal.fire("Oops!","Something went wrong, please try again later.","error")}).always(function(){t.toggleBodyBlock()}))})},initDataTable:function(){let e=this;e.$table.on("processing.dt",function(t,a,o){$(".dataTables_processing").css("display","none");let n=$(t.currentTarget).closest(".card")[0];o?e.blockUI(n):e.unBlockUI(n)});let t=e.$table.data("ordering-columns");e.dt=e.$table.DataTable({dom:'<"top">rt<"bottom-tbar"<"row p-2"<"col-lg-4"l><"col-lg-8"p>>>',paging:!0,lengthChange:!0,searching:!0,info:!0,language:{zeroRecords:e.$table.data("empty-table-msg")?e.$table.data("empty-table-msg"):"No data available in table"},autoWidth:!1,ajax:{url:e.$table.data("source"),method:"GET",data:function(a){let o=e.$formFilter.serializeArray();if(e.$formFilter){let t=e.$formFilter.find(".data-length"),o=e.$formFilter.find(".data-start");t.val(a.length).trigger("change"),o.val(a.start).trigger("change")}return o.push({name:"length",value:a.length}),o.push({name:"start",value:a.start}),a.order.length>0?(o.push({name:"order_column",value:t[a.order[0].column]}),o.push({name:"order_dir",value:a.order[0].dir})):(o.push({name:"order_column",value:t[0]}),o.push({name:"order_dir",value:"desc"})),o},dataSrc:function(e){return e.data}},ordering:e.$table.data("ordering-enabled"),order:[[0]],processing:!0,serverSide:!0,drawCallback:function(t){e.$table.find('[data-toggle="tooltip"]').tooltip()}}),e.$table.hasClass("table-select-tool")&&e.$table.on("click","tr",function(){$(this).hasClass("selected")?($(this).removeClass("selected"),e.$table.trigger("row_deselected",[e.dt])):(e.$table.find("tr.selected").removeClass("selected"),$(this).addClass("selected"),e.$table.trigger("row_selected",[e.dt]))})},loadClientData:function(e){let t=this,a=t.$newRecordBtn.data("load-client-url");a=a.replace("_0_",e),t.$clientDataContainer.LoadingOverlay("show"),$(".modal-body",t.$formModal).load(a,function(e){t.$clientDataContainer.LoadingOverlay("hide"),App.initComponents(t.$formModal.find(".modal-body")),t.$formModal.trigger("api_form_modal_loaded"),t.$formModal.modal("show")})},enableClientForm:function(){this.$clientDataContainer.find("input,select").each(function(e){$(this).prop("readonly",!1),$(this).val("").trigger("change"),"select"===$(this)[0].nodeName.toLowerCase()&&$(this).select2({disabled:!1})})},disableClientForm:function(){this.$clientDataContainer.find("input,select").each(function(e){$(this).prop("readonly",!0),"select"===$(this)[0].nodeName.toLowerCase()&&$(this).select2({disabled:!0})})},toggleBodyBlock:function(e){const t=document.querySelector("body");let a=KTBlockUI.getInstance(t);null===a?(a=new KTBlockUI(t,{message:'<div class="blockui-message"><span class="spinner-border text-primary"></span> Loading...</div>',overlayClass:"bg-primary bg-opacity-25"})).block():a.isBlocked()?a.release():a.block()},blockUI:function(e){let t=KTBlockUI.getInstance(e);null===t&&(t=new KTBlockUI(e,{message:'<div class="blockui-message"><span class="spinner-border text-primary"></span> Loading...</div>',overlayClass:"bg-primary bg-opacity-25"})).block(),t.isBlocked()||t.block()},unBlockUI:function(e){let t=KTBlockUI.getInstance(e);null===t||t.release()}},jQuery,window,document,$(".crud-scope").each(function(){new CrudManager($(this)).init()}),App.initComponents();